<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dual Universe Ore finder</title>
</head>
<style>
    body {
        font-size: 30px;
        font-family: "Trebuchet Ms";
        color: #aaaaaa;
        background-image: url("https://media.discordapp.net/attachments/273092524162416640/595483626385178646/Vortrex_wallpapper_1.jpg?width=1616&height=910");
        background-position: top left;
        background-size: cover;
        background-repeat: no-repeat;
    }
    p {font-family: "Roboto Light"}
    input[type=text] {font-size: 25px; width: 500px}
    input[type=number] {font-size: 25px; width: 90px}
</style>
<body>
<h1 style="font-size: 150%">VMS ore finder: find your ore! v0.2.0</h1> <br>

<form style="padding: 10px 0 0 10px" onsubmit="calculate()">
    <p>First Scan:</p>
        <input type="text" id="firstCoordinates" required="required" placeholder="::pos{}">
        <input type="number" id="firstRadius" required="required" min="0" max="450" placeholder="Radius"> <br/> <br/>

    <p>Second Scan:</p>
        <input type="text" id="secondCoordinates" required="required" placeholder="::pos{}">
        <input type="number" id="secondRadius" required="required" min="0" max="450" placeholder="Radius"> <br/> <br/>

    <p>Third Scan:</p>
        <input type="text" id="thirdCoordinates" required="required" placeholder="::pos{}">
        <input type="number" id="thirdRadius" required="required" min="0" max="450" placeholder="Radius"> <br/> <br/>

    <input type="submit" value="Submit">
</form>

<div id="Warning" style="display: block; float: bottom; background: rgba(20,20,20,0.7); position: fixed; bottom: 0; left: 0; right: 0">
    <div class="notice-text" style="display: block; float: left; padding: 8px 0 8px 50px; margin-right: 80px ">
        <a style="color: darkred;"> Warning: </a> <a style="font-size: 75%"> This is property of the Vortrex Mining and Science Inc. only made accessible to our Alpha Team.
            <br/>Do not copy or distribute this code or share the link.</a>
    </div>
    <div class="notice-link" style="display: block; float: right; margin-right: 30px; margin-top: 25px">
        <button type="button" style="alignment: center" onclick="collapse()"> OK </button>
        <script>function collapse() {document.getElementById("Warning").style.display = "none";} </script>
    </div>
</div>

<script>
    /*
    *Author: Will_i_craft
    *written: 26.08.2019
    *last edited: 02.09.2019
    *Synopsis: Calculates the position of the ore.
    */
     function calculate() {
         //getting the coordinate string and parsing it to
         //Format: ::pos{Dimension, Object, x, y, z} example: ::pos{0,2,33.0624,89.7918,300.6377}
         let inp;
         try {
             inp = [document.getElementById("firstCoordinates").value.substr(6, inputCoordinates[0].length).split(","),
                    document.getElementById("secondCoordinates").value.substr(6, inputCoordinates[1].length).split(","),
                    document.getElementById("thirdCoordinates").value.substr(6, inputCoordinates[2].length).split(",")];
         } catch (e) {alert("Format of Coordinates incompatible. Please check input"); return; }

         let coords = [ {Dim: inp[0][0],   obj: inp[0][1],   x: inp[0][2],     y: inp[0][3],   z: inp[0][4]},
                        {Dim: inp[1][0],   obj: inp[1][1],   x: inp[1][2],     y: inp[1][3],   z: inp[1][4]},
                        {Dim: inp[2][0],   obj: inp[2][1],   x: inp[2][2],     y: inp[2][3],   z: inp[2][4]}];


         let radii =[document.getElementById("firstRadius").value,
                    document.getElementById("secondRadius").value,
                    document.getElementById("thirdRadius").value];

        /*
        * Calculation of the coordinates
        * This calculation is based on the math used by the GPS System.
        * Source: https://journals.sagepub.com/doi/full/10.5772/63246
        */

        // fracab = (r0^2 - r1^2 + (x1-x0)^2)/2*(x1-x0)
        // fracab calculates the fraction between point a and b
        let fracab = (radii[0]**2 - radii[1]**2 + (coords[1].x - coords[0].x)**2) / (2*(coords[1].x - coords[0].x));

        //ycalc = value needed to calculate fracabc
        let alpha =   Math.atan((coords[1].y - coords[0].y) / (coords[1].x - coords[0].x))
                    - Math.atan((coords[2].y - coords[0].y) / (coords[2].x - coords[0].x));

        let ab =      Math.sqrt((coords[1].x - coords[0].x)**2 + (coords[1].y + coords[0].y)**2);

        let ycalc = Math.sin(alpha) * ab - coords[0].y;

        //fracabc calculates the fraction of the ore between
        //fracabc = (r0^2 - r2^2 + (x2 - x0)^2 + ycalc^2 - 2*(x2-x0)*fracab) / 2*ycalc;
        let fracabc = (radii[0]**2 - radii[2]**2 + (coords[2].x - coords[0].x)**2 + ycalc**2 - 2 * (coords[2].x - coords[0].x) * fracab) / (2 * ycalc);

        let distX;
        let distY;

        let oreX = coords[0].x + distX;
        let oreY = coords[0].x + distY;
        //z = âˆš(r1^2 - x^2 - y^2
        //todo: two possible answers. Evaluate with second Sphere
        let oreZ = Math.sqrt(radii[0]**2 - oreX**2 - oreY**2) * 1000;


        //todo: refactor output string

        let output = "::pos{" + coords[0].Dim + "," + coords[1].obj + "," + oreX.toFixed(4) + "," + oreY.toFixed(4)  + "," + oreZ.toFixed(2) + "}";

        console.log(output);
        alert(output);
    }
</script>
</body>
</html>