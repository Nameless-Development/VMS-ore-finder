<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dual Universe ore finder</title>
</head>
<style>
    body {
        font-size: 30px;
        color: antiquewhite;
        background-image: url("https://media.discordapp.net/attachments/273092524162416640/595483626385178646/Vortrex_wallpapper_1.jpg?width=1616&height=910");
        background-position: top left;
        background-size: cover;
        background-repeat: no-repeat;
    }
    h1 {font-size: 150%}
    h2 {font-size: 120%}
    h3 {color: red;}
    h4 {font-size: 80%; color: white; font-family: SansSerif}
    #Warning {
        position: fixed;
        padding-bottom: 10px;
        bottom: 0px;
        width: 100%;
        z-index: -1}
    input[type=text] {font-size: 25px; width: 500px}
    input[type=number] {font-size: 25px; width: 90px}
</style>
<body>
<h1>VMS ore finder: trilateral your ore! v1.0.1</h1> <br>

<form>
    <h2> Please enter the coordinates here</h2>
    <p>First Scan:</p>     <input type="text" id="firstCoordinates" required="required" placeholder="::pos{}">
                            <input type="number" id="firstRadius" required="required" min="0" max="450" placeholder="Radius"> <br/> <br/>

    <p>Second Scan:</p>    <input type="text" id="secondCoordinates" required="required" placeholder="::pos{}">
                            <input type="number" id="secondRadius" required="required" min="0" max="450" placeholder="Radius"> <br/> <br/>

    <p>Third Scan:</p>     <input type="text" id="thirdCoordinates" required="required" placeholder="::pos{}">
                            <input type="number" id="thirdRadius" required="required" min="0" max="450" placeholder="Radius"> <br/> <br/>
</form>

<button type="button" onclick="getCoordinates()">Calculate</button>

<div id="Warning">
    <h3> WARNING: </h3>
    <br>This is property of the Vortrex Mining and Science Inc.™ provided only to employees with Alpha access. </br>
        Do not distribute, share, give access to or discuss this with any non Alpha Player or any player of a different Organisation.</h4>
</div>

<script>

    /*
    This function takes the input of the html site and checks their integrity.
    written: 26.08.2019
    last edited: 02.09.2019
    */
     function getCoordinates() {
         //Getting the input from the form
        let inputCoordinates = [document.getElementById("firstCoordinates").value, document.getElementById("secondCoordinates").value, document.getElementById("thirdCoordinates").value];
        let radii = [document.getElementById("firstRadius").value, document.getElementById("secondRadius").value, document.getElementById("thirdRadius").value];

        //if you want to test accuracy type in the first form "test"
        if (inputCoordinates[0] == "test") {
            if(inputCoordinates[1] == "debug") {testCoordinates(true);}
            else {testCoordinates(false)}
            return;
        }


        //checking if any variable is missing
        for(i = 0; i<=2; i++) {
            if(inputCoordinates[i] == null || inputCoordinates[i] == "") {
                alert("Please enter Coordinates for Scan " + i+1);
                return;
            }

            if(radii[i] == null || radii[i] == 0) {
                alert("Please enter the Radius for Scan" + i+1);
                return;
            }
        }


        //Parsing input into Array
        //Format: [Dimension, Planet, x, y, z] example: ::pos{0,2,33.0624,89.7918,300.6377}
         try {
            let coordinates = [ inputCoordinates[0].substr(6, inputCoordinates[0].length).split(","),
                                inputCoordinates[1].substr(6, inputCoordinates[1].length).split(","),
                                inputCoordinates[2].substr(6, inputCoordinates[2].length).split(",")];
                calculateCoordinates(coordinates, radii, false);
        } catch (e) { alert("Format of Coordinates incompatible. Please check input");
            console.log(e);
            return; }
    }

    /*
    This function takes the coordinates and radii and calculates the position of the ore.
    written: 26.08.2019
    last edited: 02.09.2019
     */
    function calculateCoordinates(inputCoordinates, radii, test, debug) {
        //Array to Object Array
        let coordinates = [ {Dim: inputCoordinates[0][0], obj: inputCoordinates[0][1], x: inputCoordinates[0][2], y: inputCoordinates[0][3] ,z: inputCoordinates[0][4]},
                            {Dim: inputCoordinates[1][0], obj: inputCoordinates[1][1], x: inputCoordinates[1][2], y: inputCoordinates[1][3] ,z: inputCoordinates[1][4]},
                            {Dim: inputCoordinates[2][0], obj: inputCoordinates[2][1], x: inputCoordinates[2][2], y: inputCoordinates[2][3] ,z: inputCoordinates[2][4]}];

        //converting all values to the same unit (km)
        //x and y coordinates come in Kilometers however radii is in Meters
        for (i = 0; i <= 2 && !test; i++) {radii[i] /= 1000;}

        //Aligning coordinates for easy calculation
        //Setting the source of the first Sphere to (0,0,0)
        //alert(Math.sqrt(Math.pow(coordinates[1].x, 2) + Math.pow(coordinates[1].y, 2)) -
        //Math.pow(coordinates[1].x - coordinates[0].x, 2) + Math.pow(coordinates[1].y - coordinates[0].y, 2));
        for (i = 1; i <= 2; i++) {
            coordinates[i].x -= coordinates[0].x;
            coordinates[i].y -= coordinates[0].y;
        }

        //aligning the other two points to 0
        //calculating the angle between ab and ac
        let alpha = Math.atan(coordinates[1].y/coordinates[1].x) - Math.atan(coordinates[2].y/coordinates[2].x);
        let ab = Math.sqrt(coordinates[1].x**2 + coordinates[1].y**2);

        /*moving Point 2 into correct x position*/  coordinates[2].x = Math.cos(alpha) * ab;
        /*moving Point 2 into correct y position*/  coordinates[2].y = Math.sin(alpha) * ab;
        /*moving Point 1 to (x3, 0)*/  coordinates[1].x = Math.sqrt(coordinates[1].x**2 + coordinates[1].y**2);


        //Calculation of the coordinates
        //Source: https://journals.sagepub.com/doi/full/10.5772/63246

        // x = (r0^2 - r1^2 + x1^2)/2*x1
        let oreX = (radii[0]**2 - radii[1]**2 + coordinates[1].x**2) / (2*coordinates[1].x);

        //y = (r0^2 - r2^2 + x2^2 + y2^2 - 2*x2*x) / 2*y3
        let oreY = (radii[0]**2 - radii[2]**2 + coordinates[2].x**2 + coordinates[2].y**2 - 2 * coordinates[2].x * oreX) / (2 * coordinates[2].y);

        //z = √(r1^2 - x^2 - y^2
        console.log((radii[0] + ", " + oreX + ", " + oreY));
        let oreZ = Math.sqrt(radii[0]**2 - oreX**2 - oreY**2) * 1000;

        let output = "::pos{" + coordinates[0].Dim + "," + coordinates[1].obj + "," + oreX.toFixed(4) + "," + oreY.toFixed(4)  + "," + oreZ.toFixed(2) + "}";
        console.log(output);
        alert(output);

        if (test) {return [oreX.toFixed(4), oreY.toFixed(4), oreZ.toFixed(2)];}
    }

    /*
    This function should calculate random coordinates and checks the deviation of the result
    NOT WORKING RIGHT NOW
    todo: FIX THIS STUPID SHIT
    written: 27.08.2019
    last edited: 02.09.2019
     */
    function testCoordinates(debug) {
        // alert("generating coordinates");
        let goal = [(Math.random() * 5 + 10),       /*Generating random number between 10 and 15*/
                    (Math.random() * 2 + 8),        /*Generating random number between 8 and 10*/
                   -(Math.random() * 400 + 1000)];  /*Generating random number between -1000 and -1400*/
        if(debug) {console.log("goal= ::pos{0,0," + goal[0] + "," + goal[1] + "," + goal[2] + "}")}

        let radii = [parseInt(Math.random() * 300 + 100),
                     parseInt(Math.random() * 300 + 100),
                     parseInt(Math.random() * 300 + 100)];
        if(debug) {console.log("radii are: " + radii[0] + ", " + radii[1] + ", " + radii[2])}

        let coordinates = [[],[],[]];
        let difference;
        for (i=0; i<=2; i++) {
            coordinates[i][0]= 0;
            coordinates[i][1] = 0;
            coordinates[i][2] = goal[0] - Math.sqrt(radii[i]**2 - (Math.random() * radii[i])**2);
            coordinates[i][3] = goal[1]
            coordinates[i][4] = goal[2]

            if (debug) {console.log("position[" + i + "]= ::pos{0,0," + coordinates[i][2].toFixed(4)  + "," + coordinates[i][3].toFixed(4) + "," + coordinates[i][4].toFixed(2) + "}");
            difference = Math.sqrt(coordinates[i][2]**2 + coordinates[i][3]**2 + coordinates[i][4]**2)-radii[i];
            console.log("difference: " + difference)}
        }

        let shot = calculateCoordinates(coordinates, radii, true, debug);
    }
</script>
</body>
</html>